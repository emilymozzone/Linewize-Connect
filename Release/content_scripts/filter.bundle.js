(()=>{"use strict";var e={841:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.EVerdictAction=void 0,(n=t.EVerdictAction||(t.EVerdictAction={}))[n.BLOCK=0]="BLOCK",n[n.ALLOW=1]="ALLOW"},436:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ContentScriptMessageType=void 0,(n=t.ContentScriptMessageType||(t.ContentScriptMessageType={})).ASYNC_VERDICT="ASYNC_VERDICT",n.CHECK_INTERNET_CONNECTION="CHECK_INTERNET_CONNECTION"},333:(e,t)=>{var n,a,o,s,i,c,r,d,l,_,h,u,g,C,m,p,f,v,y,T,w,I,E;Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserTypes=t.youtubeStrictSafesearch=t.companionWebGrpcUrl=t.CompanionFeatures=t.MessageTypes=t.LogLevel=t.LogLevelTypes=t.EventTypes=t.UniqueScheduleIds=t.SchedulesConstants=t.ScreenshotPersisterConstants=t.ConnectionsConstants=t.AuthenticateConstants=t.ContentAwareLicenseStatus=t.ContentAwareIECMessageTypes=t.ContentAwareConstants=t.DelegationReporting=t.DelegationConstants=t.SystemConfigConstants=t.CompanionConstants=t.MainConstants=t.TabsConstants=t.ConfigFetcherConstants=t.ChatConstants=t.ConfigConstants=t.VerdictStoreConstants=t.FallbackVerdictStoreConstants=t.FilteringConstants=t.FirestoreDocIds=t.KeepAliveConstants=t.FzboxConstants=t.DMSManagerConstants=t.UpdaterConstants=void 0,(E=t.UpdaterConstants||(t.UpdaterConstants={})).FcmMessagesCacheId="lw_updater_fcm_messages_cache_id",E.GeneralCacheId="lw_updater_general_cache_id",E.RegistrationCacheId="lw_updater_registration_cache",(I=t.DMSManagerConstants||(t.DMSManagerConstants={})).DmsDataCacheId="lw_dms_data_cache",I.DmsManagerConfigCacheId="lw_dms_manager_config_cache",I.CheckInDeviceInterval="lw_dms_check_in",I.RetryDMSRegTimeout="lw_retry_dms_registration_timeout",I[I.CheckInDeviceElapsed_ms=3e5]="CheckInDeviceElapsed_ms",(w=t.FzboxConstants||(t.FzboxConstants={}))[w.WalledGardenBasedInterval=3e4]="WalledGardenBasedInterval",w[w.DefaultPollingInterval=3e5]="DefaultPollingInterval",(t.KeepAliveConstants||(t.KeepAliveConstants={})).KeepAliveCacheId="lw_keep_alive_cache_id",(t.FirestoreDocIds||(t.FirestoreDocIds={})).ContentAware="ca",(T=t.FilteringConstants||(t.FilteringConstants={})).HandleVerdictQueueInterval="lw_handle_verdict_queue_interval",T.EvictOldResponsesInterval="lw_evict_old_responses",T.VerdictRawResponseCacheId="lw_verdict_raw_response_cache",T.FallbackVerdictsCacheId="lw_fallback_verdicts_cache",T.VerdictResponseTimeCacheId="verdict_response_time_cache",T.VerdictYoutubeQueryCacheId="verdict_youtube_query_cache",T.VerdictClientFallback="client_fallback",T.CustomHeaderCacheId="lw_custom_header_cache",T.CustomHeaderCacheCleanIntervalId="lw_custom_header_cache_interval_id",T[T.CustomHeaderCacheCleanInterval=3e5]="CustomHeaderCacheCleanInterval",T[T.CustomHeaderCacheExpireTime=36e5]="CustomHeaderCacheExpireTime",(t.FallbackVerdictStoreConstants||(t.FallbackVerdictStoreConstants={})).PurgeOldVerdictEntries="purge_old_verdict_entries",(y=t.VerdictStoreConstants||(t.VerdictStoreConstants={})).EvictOldResponsesInterval="lw_evict_old_responses",y.VerdictResponseCacheId="lw_verdict_response_cache",(v=t.ConfigConstants||(t.ConfigConstants={})).ConfigurationCacheId="lw_configuration_cache",v[v.ConfigLoadTimeout_ms=1e4]="ConfigLoadTimeout_ms",(f=t.ChatConstants||(t.ChatConstants={})).ChatDataCacheId="lw_chat_data_cache",f.OpenChatTimeout="lw_open_chat_timeout",(t.ConfigFetcherConstants||(t.ConfigFetcherConstants={})).ClassConfigRefreshTimeout="lw_class_config_refresh",(p=t.TabsConstants||(t.TabsConstants={})).FocusLockCheckTimeout="lw_tabs_focuslock_check",p.ScreenshotUploadInterval="lw_screenshot_upload_interval",p.TabsDataCacheId="lw_tabs_data_cache",(m=t.MainConstants||(t.MainConstants={})).PeriodicLoginInterval="lw_periodic_login",m.WhoamiLoginInterval="lw_whoami_login",m.FzboxPollInterval="lw_fzbox_poll",m.MainDataCacheId="lw_main_data_cache",m.DevDataCacheId="lw_dev_data_cache",m.LoadingConfiKey="lw_loading_config_key",m.RemainingUpdatesKey="lw_remaining_updates_key",m.DevBuildReloadedKey="lw_dev_build_reloaded_key",m[m.ResourceLimitThresholdCheckInterval=72e5]="ResourceLimitThresholdCheckInterval",(C=t.CompanionConstants||(t.CompanionConstants={})).CacheId="lw_companion_cache",C[C.MaxReconnectionAttempts=5]="MaxReconnectionAttempts",C[C.DeltaTimeout=5e3]="DeltaTimeout",C[C.MaxRetryRegistrationInterval_ms=3e4]="MaxRetryRegistrationInterval_ms",(t.SystemConfigConstants||(t.SystemConfigConstants={})).CacheId="lw_system_config_cache",(g=t.DelegationConstants||(t.DelegationConstants={})).CacheId="lw_delegation_config_cache",g.DelegationChangeScheduleId="lw_delegation_change_schedule_id",(u=t.DelegationReporting||(t.DelegationReporting={})).ALL="all",u.BLOCKED="blocked",u.NONE="none",(t.ContentAwareConstants||(t.ContentAwareConstants={})).CacheId="lw_content_aware_config_cache",(h=t.ContentAwareIECMessageTypes||(t.ContentAwareIECMessageTypes={})).login="LOGIN",h.logout="LOGOUT",h.isLoggedIn="IS_LOGGED_IN",h.resetConfig="RESET-CONFIG",h.UpdateDynamicConfig="UPDATE-CONFIG-ALL",(_=t.ContentAwareLicenseStatus||(t.ContentAwareLicenseStatus={})).active="ACTIVE",_.suspended="SUSPENDED",(l=t.AuthenticateConstants||(t.AuthenticateConstants={})).PartialFailedCacheId="lw_partial_failed_cache",l.AuthenticationData="lw_authentication_data_cache",l.AuthTokenKey="auth_token",(d=t.ConnectionsConstants||(t.ConnectionsConstants={})).ConnectionsCacheId="lw_connections_cache",d.ConnectionsUploadInterval="lw_Connections_upload_interval",d.TabsCacheId="lw_tabs_cache",d.UploadInfoCacheId="lw_upload_info_cache",d.mainFrameRequestType="main_frame",d.eventTypeSendHeaders="sendHeaders",d.eventTypeBeforeRequest="beforeRequest",d.eventTypeHeadersReceived="headersReceived",d.eventTypeCompleted="completed",(t.ScreenshotPersisterConstants||(t.ScreenshotPersisterConstants={})).LastScreenshotCacheId="last_screenshot_cache",(t.SchedulesConstants||(t.SchedulesConstants={})).SchedulesDataCacheId="lw_schedule_manager_data_cache_id",(r=t.UniqueScheduleIds||(t.UniqueScheduleIds={})).ConfigUpdate="config_update_with_delay",r.CaptureTabAndSend="capture_tab_and_send",r.SendRuntimeMessage="send_runtime_message",r.PrintBlockedMessage="print_blocked_message",r.CreateNewChromeTab="create_new_chrome_tab",(c=t.EventTypes||(t.EventTypes={})).CONFIG_UPDATE="CONFIG_UPDATE",c.OPEN_TAB="OPEN_TAB",c.CLOSE_TAB="CLOSE_TAB",c.MESSAGE="MESSAGE",c.CLASS_STARTED="CLASS_STARTED",c.POLICY_UPDATE="POLICY_UPDATE",c.INIT_P2P="INIT_P2P",(i=t.LogLevelTypes||(t.LogLevelTypes={})).Error="logging__error",i.Warning="logging__warning",i.Message="logging__message",i.Debug="logging__debug",(s=t.LogLevel||(t.LogLevel={})).INFO="INFO",s.WARN="WARN",s.ERROR="ERROR",s.DEBUG="DEBUG",(o=t.MessageTypes||(t.MessageTypes={})).InitOffscreenDocument="init_offscreen_socument_message",o.RegisterExtension="register_extension_with_native_agent",o.UnregisterExtension="unregister_extension_from_native_agent",o.RegisterClasswizeEventFail="register_extension_with_native_agent_classwize_events_fail",o.RegisterClasswizeEventMessage="register_extension_with_native_agent_classwize_events_Message",o.IsExtensionRegistered="is_extension_registered_with_native_agent",o.CompanionMessage="message_from_native_agent",o.CompanionErrorMessage="error_message_from_native_agent",o.RecoverCompanionStream="recover_companion_stream",o.RetryRegistration="retry_registration_with_native_agent",o.IpAddressChangeRoutine="ip_address_change_routine",o.TabsActivated="tabs_activated_message",o.UrlUpdatedInTab="url_updated_in_tab",o.P2PInitSignaler="p2p_init_signaler_message",o.P2PSetCloseTimeouts="p2p_set_close_timeouts_message",o.P2PGetScreenshot="p2p_get_screenshot_message",o.P2PGetTabs="p2p_get_tabs_message",o.UtilLocalIpUpdated="util_local_ip_updated_message",o.UtilResizeAndCompressImage="util_resize_and_compress_image",o.BroadcastWakeUpCall="cachescheduler_broadcast_wakeup_call",o.BroadcastScheduleTime="schedule-time-ee236fce-1426-4975-9d56-2ce4e8becd02",o.ChatBubbleStatus="chat_status",o.ChatInfo="chat_info",o.ChatGetLastMessage="last_chat_message",o.ChatClearLastMessage="clear_last_chat_message",o.UIGetStatus="ui_get_status",o.UIReloadConfig="ui_reload_config",o.UISendLogs="ui_send_logs",o.UpdaterNewMessage="updater_new_message",o.GetSafeguardVerdict="get_safe_guard_verdict",o.RedirectWebPage="redirect_web_page",o.EventMessage="event_service_message",o.InitAutoAuth="init_auto_auth",o.GetAuthCookie="get_auth_cookie",o.GetAuthToken="get_auth_token",o.UploadLogData="upload_log_data",o.UpdateOffscreenConfig="update_offscreen_config",o.MainConfigUpdated="main_config_updated",o.OffScreenLogMessage="Off_screen_log_message",o.GetManifestInfo="get_manifest_info",o.Token="TOKEN",o.ChatConfigUpdate="CHAT_CONFIG_UPDATE",o.UpdateTotalUnreadCount="UPDATE_TOTAL_UNREAD_COUNT",o.OpenChatClassroom="OPEN_CHAT_CLASSROOM",o.GoogleAuthenticate="GOOGLE_AUTHENTICATE",o.NativeTokenAuthenticate="NATIVE_TOKEN_AUTHENTICATE",o.GetBrowserType="get_browser_type",o.GetBrowserDetails="get_browser_details",o.CheckIfDomainIsBlocked="check_if_domain_is_blocked",o.ExtractFallbackDomains="extract_fallback_domains",o.LogMessage="log_message",o.InitOpenTelemetry="initialize-open-telemetry-client",o.StartOTELSpan="start-open-telemetry-span",o.SetOTELSpanOkay="set-open-telemetry-span-is-okay",o.RecordOTELSpanException="record-open-telemetry-span-exception",o.EndOTELSpan="end-open-telemetry-span",o.SendOTELLogs="send-open-telemetry-logs",o.CloseOTEL="shutdown-open-telemetry-client",(a=t.CompanionFeatures||(t.CompanionFeatures={})).companion="companion",a.companionLite="companion_lite",a.proxyFilter="proxy_filter",a.dns_filter="dns_filter",a.classroom="classroom",a.liteModeEnabled="companion-mode-lite-enabled",t.companionWebGrpcUrl="http://127.0.0.1:5769",t.youtubeStrictSafesearch="STRICT",(n=t.BrowserTypes||(t.BrowserTypes={})).chrome="chrome",n.edge="edge"},477:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static handleContentMod(e){switch(e.action){case"remove":this.hideDomBySelector(e.target);break;case"replace":this.replaceDomBySelector(e.target,e.value);break;default:console.warn(`[ContentMods] Unknown action: ${e.action}`)}}static hideDomBySelector(e){try{const t=e+" {display: none !important;}",n=document.createElement("style");if(n.type="text/css",n.styleSheet)n.styleSheet.cssText=t;else{const e=document.createTextNode(t);n.appendChild(e)}const a=document.getElementsByTagName("head");if(a.length>0)a[0].appendChild(n);else{console.warn('document error: missing the "head" element');const e=document.createElement("head");e.appendChild(n);const t=document.getElementsByTagName("html");if(t.length<=0)return void console.error('document error: missing the "html" element');t[0].appendChild(e)}console.log(`Succeeded in removing the selector '${e}'`)}catch(t){console.warn(`Failed to remove the selector '${e}':`,t)}}static replaceDomBySelector(e,t){try{const n=document.querySelectorAll(e);for(let e=0;e<n.length;++e)n[e].innerText=t;console.log(`Succeeded in replacing ${n.length} DOM elements to '${t}' with the selector '${e}`)}catch(t){console.warn(`Failed to replace the selector '${e}':`,t)}}}},658:function(e,t){var n=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function i(e){try{r(a.next(e))}catch(e){s(e)}}function c(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}r((a=a.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const a=new class{constructor(){this.maxPageHideAttempts=5,this.documentHiderId="linewize-protect",this.blockCounter=0}tryHidingPage(){return n(this,void 0,void 0,(function*(){return new Promise((e=>{window.requestAnimationFrame((()=>n(this,void 0,void 0,(function*(){try{yield this.hidePage.bind(this)(),e()}catch(t){yield this.tryHidingPage.bind(this)(),e()}}))))}))}))}hidePage(){return n(this,void 0,void 0,(function*(){return new Promise((e=>{this.blockCounter+=1,this.blockCounter<=this.maxPageHideAttempts&&!this.checkHiderIsStillPresent()?(console.log("Hiding page content"),this.documentHider=document.createElement("div"),this.documentHider.style.position="fixed",this.documentHider.style.width="100%",this.documentHider.style.height="100%",this.documentHider.style.zIndex="2147483647",this.documentHider.style.background="rgba(255,255,255,1)",this.documentHider.style.display="block",this.documentHider.style.left="0",this.documentHider.style.top="0",this.documentHider.id=this.documentHiderId,document.body.appendChild(this.documentHider),console.log("Successfully hid page content")):console.log("Hiding page content failed after the max page hide attemps"),e()}))}))}unHidePage(){console.log("Displaying page again");try{this.checkHiderIsStillPresent()&&(this.documentHider.remove(),document.querySelectorAll(`[id=${this.documentHiderId}]`).forEach((e=>e.remove())))}catch(e){console.log("Failed to un-hide document",e);try{document.getElementById(this.documentHiderId).remove()}catch(e){console.log("Failed to find element in document",e)}}}checkHiderIsStillPresent(){return!!(this.documentHider&&this.documentHider.parentNode||document.getElementById(this.documentHiderId))}};t.default=a},32:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{static checkPage(){return this.checkTitle()||this.checkContent()}static checkTitle(){return document.title.length>0&&this.titleRegex.test(document.title)}static checkContent(){const e=document.evaluate(this.contentQuery,document,null,XPathResult.ANY_TYPE,null).iterateNext();if(e&&e.textContent){const t=e.textContent.toLowerCase();for(const e of this.contentKeywords)if(-1!==t.indexOf(e))return!0}return!1}}t.default=n,n.titleRegex=new RegExp("porn","i"),n.contentQuery="//body[contains(., 'age-restricted') or contains(., 'Warning: This Site Contains Sexually Explicit Content') or contains(., ' contains adult material') or contains(., 'website contains adult material') or contains(., 'ADULTS ONLY DISCLAIMER') or contains(., 'Warning: You must be 18 years or older') or contains(., 'adult-only') or contains(., 'porn') or contains(., 'fuck')]",n.contentKeywords=["porn","sex","adult"]},344:function(e,t,n){var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function i(e){try{r(a.next(e))}catch(e){s(e)}}function c(e){try{r(a.throw(e))}catch(e){s(e)}}function r(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}r((a=a.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(841),i=n(436),c=n(333),r=o(n(477)),d=o(n(658)),l=o(n(32));(new class{constructor(){this.currentUrl=window.location.href,this.connectedToInternet=void 0,this.whitePageRemoveMs=5500}init(){return a(this,void 0,void 0,(function*(){console.log("Hiding page and executing checks to ensure it is safe to show"),yield d.default.tryHidingPage(),chrome.runtime.onMessage.addListener((e=>{e.type===c.MessageTypes.TabsActivated&&this.getVerdictAndUnhide.bind(this).call()})),chrome.runtime.onMessage.addListener((e=>{e.type===c.MessageTypes.UrlUpdatedInTab&&this.currentUrl!==window.location.href&&(this.currentUrl=window.location.href,this.getVerdictAndUnhide.bind(this,!0).call())})),chrome.runtime.onMessage.addListener(((e,t,n)=>{if(e.type===c.MessageTypes.GetSafeguardVerdict){const t=window.top==window.self;return this.documentLoadFallbackCheck().then((o=>a(this,void 0,void 0,(function*(){t&&(o||(void 0===this.connectedToInternet&&(this.connectedToInternet=yield this.sendRuntimeMessage({type:i.ContentScriptMessageType.CHECK_INTERNET_CONNECTION})),o=!this.connectedToInternet),n(o?s.EVerdictAction.ALLOW:s.EVerdictAction.BLOCK)),o||this.redirectToBlockPage(e.blockPageUrl)})))),t}})),this.getVerdictAndUnhide(!0)}))}redirectToBlockPage(e){return a(this,void 0,void 0,(function*(){setTimeout((()=>{console.warn("Fallback check failed, redirecting to block page"),window.location.href=e}),500)}))}sendRuntimeMessage(e){return a(this,void 0,void 0,(function*(){return new Promise((t=>{chrome.runtime.sendMessage(e,(e=>{t(e)}))}))}))}getVerdictAndUnhide(e=!1){return a(this,void 0,void 0,(function*(){if(e||d.default.checkHiderIsStillPresent()){console.log("Requesting verdict for this page");const e=setTimeout((()=>{this.documentLoadFallbackCheck().then((e=>{e&&d.default.unHidePage()}))}),this.whitePageRemoveMs);if(this.verdict=yield this.sendRuntimeMessage({type:i.ContentScriptMessageType.ASYNC_VERDICT,url:this.currentUrl}),clearTimeout(e),console.log("Verdict received:",this.verdict),!(yield this.checkRequest()))return;console.log("Page checks passed, showing page again"),d.default.unHidePage()}}))}checkRequest(){return a(this,void 0,void 0,(function*(){if(!this.verdict)return!0;if(this.verdict.redirect_uri)return window.location.href=this.verdict.redirect_uri,!1;if(this.verdict.verdict===s.EVerdictAction.BLOCK)return!1;if(this.verdict.content_mod){console.log("Verdict contains content modifications, applying them");for(const e of this.verdict.content_mod)r.default.handleContentMod(e)}return console.log("Verdict checks passed"),!0}))}documentLoadFallbackCheck(){return a(this,void 0,void 0,(function*(){return new Promise((e=>{"interactive"===document.readyState||"complete"===document.readyState?e(this.runFallbackChecks()):document.addEventListener("DOMContentLoaded",(()=>{e(this.runFallbackChecks())}),!0)}))}))}runFallbackChecks(){return a(this,void 0,void 0,(function*(){return console.log("Checking page against fallback filter to ensure CIPA compliance"),!l.default.checkPage()&&(console.log("Fallback check passed"),!0)}))}}).init().catch((e=>{console.error("Failed to filter page, hiding it permanently to protect the student",e),d.default.tryHidingPage()}))}},t={};!function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,n),s.exports}(344)})();